var cols=20,rows=20,stopSignal,alive=[],delay=100,mode="dead",longliness=2,overpopulation=3,radius=1,upperbound=4*radius*radius+4*radius;generationMin=3,generationMax=3;var buildGrid=function(e,i){var a="";alive=[];for(var o=0;e>o;o++){a+="<tr>",alive.push([]);for(var l=0;i>l;l++)a+="<td id = "+(o*e+l)+"></td>",alive[o].push(0);a+="</tr>"}$("#gridTable").html(a)},reBuildGrid=function(){for(var e=0;rows>e;e++)for(var i=0;cols>i;i++)alive[e][i]=0,$("#"+(e*rows+i)).hasClass("live")&&$("#"+(e*rows+i)).removeClass("live"),$("#"+(e*rows+i)).hasClass("dead")&&$("#"+(e*rows+i)).removeClass("dead")},liveNumAllDeadWithDefaultRadius=function(e,i){var a=0;if("dead"==mode||"live"==mode){var o=0;"dead"==mode?o=0:"live"==mode&&(o=1),a=(void 0!=alive[e-1]&&void 0!=alive[e-1][i-1]?alive[e-1][i-1]:o)+(void 0!=alive[e-1]?alive[e-1][i]:o)+(void 0!=alive[e-1]&&void 0!=alive[e-1][i+1]?alive[e-1][i+1]:o)+(void 0!=alive[e][i-1]?alive[e][i-1]:o)+(void 0!=alive[e][i+1]?alive[e][i+1]:o)+(void 0!=alive[e+1]&&void 0!=alive[e+1][i-1]?alive[e+1][i-1]:o)+(void 0!=alive[e+1]?alive[e+1][i]:o)+(void 0!=alive[e+1]&&void 0!=alive[e+1][i+1]?alive[e+1][i+1]:o)}else"toroidal"==mode&&(a=(void 0!=alive[e-1]&&void 0!=alive[e-1][i-1]?alive[e-1][i-1]:0!=e?alive[e-1][cols-1]:0!=i?alive[rows-1][i-1]:alive[rows-1][cols-1])+(void 0!=alive[e-1]?alive[e-1][i]:alive[rows-1][i])+(void 0!=alive[e-1]&&void 0!=alive[e-1][i+1]?alive[e-1][i+1]:0!=e?alive[e-1][0]:i!=cols-1?alive[rows-1][i+1]:alive[rows-1][0])+(void 0!=alive[e][i-1]?alive[e][i-1]:alive[e][cols-1])+(void 0!=alive[e][i+1]?alive[e][i+1]:alive[e][0])+(void 0!=alive[e+1]&&void 0!=alive[e+1][i-1]?alive[e+1][i-1]:e!=rows-1?alive[e+1][cols-1]:0!=i?alive[0][i-1]:alive[0][cols-1])+(void 0!=alive[e+1]?alive[e+1][i]:alive[0][i])+(void 0!=alive[e+1]&&void 0!=alive[e+1][i+1]?alive[e+1][i+1]:e!=rows-1?alive[e+1][0]:i!=cols-1?alive[0][i+1]:alive[0][0]));return a},outIndex=function(e,i){var a,o;return e>=0&&rows>e&&i>=0&&cols>i?(a=e,o=i):(e>=0&&rows>e?a=e:0>e?a=parseInt(rows)+parseInt(e):e>=rows&&(a=parseInt(e)-parseInt(rows)),i>=0&&cols>i?o=i:0>i?o=parseInt(cols)+parseInt(i):i>=cols&&(o=parseInt(i)-parseInt(cols))),[a,o]},liveNum=function(e,i){var a=0;"dead"==mode?alive_point=0:"live"==mode&&(alive_point=1);for(var o=-radius;radius>=o;o++)for(var l=-radius;radius>=l;l++)if(0!=o||0!=l)if("dead"==mode||"live"==mode)a+=e+o>=0&&rows>e+o&&i+l>=0&&cols>i+l?alive[e+o][i+l]:alive_point;else if("toroidal"==mode){var t=outIndex(e+o,i+l);a+=alive[t[0]][t[1]]}return a},oneIteration=function(){for(var e=0;rows>e;e++)for(var i=0;cols>i;i++){var a=liveNum(e,i);if(1==alive[e][i])if(longliness>a)$("#"+(e*rows+i)).removeClass("live").addClass("dead");else{if(overpopulation>=a)continue;$("#"+(e*rows+i)).removeClass("live").addClass("dead")}else 3==a&&($("#"+(e*rows+i)).hasClass("dead")&&$("#"+(e*rows+i)).removeClass("dead"),$("#"+(e*rows+i)).addClass("live"))}for(var e=0;rows>e;e++)for(var i=0;cols>i;i++){var o=$("#"+(e*rows+i)).attr("class");"dead"==o?alive[e][i]=0:"live"==o&&(alive[e][i]=1)}},randomAlive=function(){for(var e=rows*cols,i=0;i<Math.floor(.15*e);i++){var a=Math.floor(Math.random()*e),o=Math.floor(a/rows),l=a%rows;alive[o][l]=1,$("#"+a).addClass("live")}},nextStep=function(){oneIteration(),stopSignal=setTimeout(nextStep,delay)},reset=function(){clearInterval(stopSignal),reBuildGrid()};$(function(){buildGrid(rows,cols),randomAlive(),$("#sizeSlider").slider({formatter:function(e){return rows=e,cols=e,buildGrid(rows,cols),"Current value: "+e}}).change(function(){}),$("#speedSlider").change(function(){}).slider({formatter:function(e){return delay=Math.floor(1e3/e),"Current value: "+e}}),$("#gridTable").delegate("td","click",function(e){$("#start").attr("disabled",!1),$("#step").attr("disabled",!1);var i=Math.floor($(this).attr("id")/rows),a=$(this).attr("id")%rows;e.ctrlKey?(alive[i][a]=0,$(this).hasClass("live")&&$(this).removeClass("live").addClass("dead")):e.shiftKey?(alive[i][a]=1,$(this).hasClass("dead")&&$(this).removeClass("dead").addClass("live")):($(this).toggleClass("live"),alive[i][a]=!alive[i][a])}),$("#random").click(function(){reset(),randomAlive(),$("#start").attr("disabled",!1),$("#step").attr("disabled",!1)}),$("#reset").click(function(){reset(),$("#start").attr("disabled",!0),$("#step").attr("disabled",!0)}),$("#start").click(function(){$(this).attr("disabled",!0),$("#step").attr("disabled",!0),stopSignal=setTimeout(nextStep,delay)}),$("button#start").trigger("click"),$("#step").click(function(){oneIteration()}),$("#stop").click(function(){clearTimeout(stopSignal),$("#start").attr("disabled",!1),$("#step").attr("disabled",!1)}),$("div#mode select").change(function(){mode=$(this).val()}),$("div #upper").text(upperbound),$("#radius").change(function(){}).slider({formatter:function(e){return radius=e,upperbound=parseInt(radius)*parseInt(radius)*4+4*parseInt(radius),$("div #upper").text(upperbound),$("#lonely, #overPop, #gMin, #gMax").attr("max",upperbound),"Current value: "+e}}),$("#lowerOverPop").text(longliness),$("#lonely").change(function(){longliness=$(this).val(),$("#lowerOverPop").text(longliness),$("#overPop").attr("min",longliness)}),$("#overPop").change(function(){overpopulation=$(this).val()}),$("#lowerGMax").text(generationMin),$("#gMin").change(function(){generationMin=$(this).val(),$("#lowerGMax").text(generationMin),$("#gMax").attr("min",generationMin)}),$("#gMax").change(function(){generationMax=$(this).val()}),$("div button#more").click(function(){"moreSetting"==$(this).attr("name")?($(this).text("Show less"),$("#moreSetting").show(500),$(this).attr("name","lessSetting")):($(this).text("Show more"),$("#moreSetting").hide(500),$(this).attr("name","moreSetting"))})});